{{ $projects := where $.Site.RegularPages "Section" "projects" }}
{{ $num_projects := len $projects }}
{{ if $.IsHome }}
  {{ $num_projects = 3 }}
{{ end}}

<div class="projects">
  {{ range first $num_projects $projects.ByWeight.Reverse }}
    {{ partial "project-listing.html" . }}
  {{ end }}
</div>
